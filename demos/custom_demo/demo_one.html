<!DOCTYPE html>
<html lang="en">
<head>
    <!-- OneSignal SDK-->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({
          appId: "cf532c5e-5be2-4b00-ab6d-3d3d72ca9124",
        });
      });
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windshield Repair Service - Book Appointment</title>
    <link rel="icon" type="image/png" href="../../assets/images/icon_with_25_percent_margin.png">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: #F4F4F4;
            min-height: 100vh;
            padding: 3rem 1.5rem;
            color: #1A1A1A;
            line-height: 1.6;
        }

        .container {
            background: #FFFFFF;
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .header {
            background: #0A2A66;
            color: white;
            padding: 3rem 3rem 2.5rem;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .header p {
            font-size: 1rem;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.5;
        }

        .form-container {
            padding: 3rem;
        }

        .form-section {
            margin-bottom: 3rem;
        }

        .form-section:last-of-type {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #0A2A66;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #0A2A66;
            letter-spacing: -0.01em;
            line-height: 1.3;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #1A1A1A;
            margin-bottom: 0.5rem;
            font-size: 0.9375rem;
            line-height: 1.4;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid #D0D0D0;
            border-radius: 2px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
            font-family: inherit;
            background: #FFFFFF;
            color: #1A1A1A;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0A2A66;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #6F6F6F;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .addon-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .addon-item {
            background: #FFFFFF;
            border: 1px solid #D0D0D0;
            border-radius: 2px;
            padding: 1rem;
            cursor: pointer;
            transition: border-color 0.2s ease, background-color 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 0.875rem;
        }

        .addon-item:hover {
            border-color: #0A2A66;
            background: #FAFAFA;
        }

        .addon-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin-top: 0.125rem;
            flex-shrink: 0;
        }

        .addon-content {
            flex: 1;
        }

        .addon-name {
            font-weight: 600;
            color: #1A1A1A;
            margin-bottom: 0.25rem;
            font-size: 0.9375rem;
            line-height: 1.4;
        }

        .addon-price {
            color: #0A2A66;
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .addon-description {
            color: #6F6F6F;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .submit-btn {
            width: 100%;
            background: #D62828;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 2px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-top: 1rem;
            letter-spacing: 0.01em;
        }

        .submit-btn:hover {
            background: #B82020;
        }

        .submit-btn:active {
            background: #A01C1C;
        }

        /* Success Modal */
        .success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .success-content {
            background: white;
            border-radius: 2px;
            padding: 3rem;
            max-width: 550px;
            width: 100%;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .success-icon {
            width: 64px;
            height: 64px;
            background: #0A2A66;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2rem;
        }

        .success-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1A1A1A;
            margin-bottom: 1rem;
            text-align: center;
            letter-spacing: -0.01em;
            line-height: 1.3;
        }

        .success-message {
            font-size: 1rem;
            color: #6F6F6F;
            margin-bottom: 2rem;
            line-height: 1.6;
            text-align: center;
        }

        .booking-details {
            background: #F4F4F4;
            border-radius: 2px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .booking-detail-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #D0D0D0;
            gap: 1rem;
        }

        .booking-detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #6F6F6F;
            font-size: 0.9375rem;
        }

        .detail-value {
            color: #1A1A1A;
            font-weight: 600;
            text-align: right;
            font-size: 0.9375rem;
        }

        .close-modal-btn {
            background: #0A2A66;
            color: white;
            border: none;
            padding: 0.875rem 2rem;
            border-radius: 2px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: 100%;
            letter-spacing: 0.01em;
        }

        .close-modal-btn:hover {
            background: #082050;
        }

        .required {
            color: #D62828;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 1.5rem 1rem;
            }

            .header {
                padding: 2rem 1.5rem;
            }

            .header h1 {
                font-size: 1.75rem;
            }

            .header p {
                font-size: 0.9375rem;
            }

            .form-container {
                padding: 2rem 1.5rem;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .addon-options {
                grid-template-columns: 1fr;
            }

            .success-content {
                padding: 2rem 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 1.5rem 1.25rem;
            }

            .form-container {
                padding: 1.5rem 1.25rem;
            }

            .success-content {
                padding: 1.5rem 1.25rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Windshield Repair Service</h1>
            <p>Schedule your appointment with our certified technicians nationwide</p>
        </div>

        <div class="form-container">
            <form id="booking-form">
                <!-- Vehicle Information -->
                <div class="form-section">
                    <h2 class="section-title">Vehicle Information</h2>

                    <div class="form-group">
                        <label for="registration">Vehicle Registration Number <span class="required">*</span></label>
                        <input type="text" id="registration" placeholder="AB12 CDE" required>
                    </div>

                    <div class="form-group">
                        <label for="window-type">Glass Type <span class="required">*</span></label>
                        <select id="window-type" required>
                            <option value="">Select glass type</option>
                            <option value="windshield">Windshield (Front)</option>
                            <option value="rear-windshield">Rear Windshield</option>
                            <option value="driver-side">Driver Side Window</option>
                            <option value="passenger-side">Passenger Side Window</option>
                            <option value="rear-driver-side">Rear Driver Side Window</option>
                            <option value="rear-passenger-side">Rear Passenger Side Window</option>
                        </select>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="form-section">
                    <h2 class="section-title">Contact Information</h2>

                    <div class="form-group">
                        <label for="customer-name">Full Name <span class="required">*</span></label>
                        <input type="text" id="customer-name" placeholder="John Smith" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="customer-phone">Phone Number <span class="required">*</span></label>
                            <input type="tel" id="customer-phone" value="+447437190274" required>
                        </div>

                        <div class="form-group">
                            <label for="customer-email">Email Address <span class="required">*</span></label>
                            <input type="email" id="customer-email" value="claudio@onesignal.com" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customer-language">Preferred Language <span class="required">*</span></label>
                        <select id="customer-language" required>
                            <option value="english" selected>English</option>
                            <option value="danish">Danish</option>
                            <option value="swedish">Swedish</option>
                            <option value="norwegian">Norwegian</option>
                            <option value="german">German</option>
                            <option value="french">French</option>
                            <option value="spanish">Spanish</option>
                        </select>
                    </div>
                </div>

                <!-- Workshop Location -->
                <div class="form-section">
                    <h2 class="section-title">Service Location</h2>

                    <div class="form-group">
                        <label for="workshop">Select Workshop <span class="required">*</span></label>
                        <select id="workshop" required>
                            <option value="">Choose nearest location</option>
                            <option value="london-central">London Central - 123 High St, London, EC1A 1BB</option>
                            <option value="manchester">Manchester North - 456 Market St, Manchester, M1 1AE</option>
                            <option value="birmingham">Birmingham City - 789 Bull St, Birmingham, B1 1AA</option>
                            <option value="glasgow">Glasgow West End - 321 Sauchiehall St, Glasgow, G2 3AA</option>
                            <option value="edinburgh">Edinburgh Centre - 654 Princes St, Edinburgh, EH2 2DQ</option>
                            <option value="leeds">Leeds Downtown - 987 The Headrow, Leeds, LS1 3AB</option>
                        </select>
                    </div>
                </div>

                <!-- Appointment Details -->
                <div class="form-section">
                    <h2 class="section-title">Appointment Schedule</h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="appointment-date">Date <span class="required">*</span></label>
                            <input type="date" id="appointment-date" required>
                        </div>

                        <div class="form-group">
                            <label for="appointment-time">Time <span class="required">*</span></label>
                            <select id="appointment-time" required>
                                <option value="">Select time slot</option>
                                <option value="09:00">09:00</option>
                                <option value="10:00">10:00</option>
                                <option value="11:00">11:00</option>
                                <option value="12:00">12:00</option>
                                <option value="13:00">13:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:00">15:00</option>
                                <option value="16:00">16:00</option>
                                <option value="17:00">17:00</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Add-on Services -->
                <div class="form-section">
                    <h2 class="section-title">Additional Services</h2>

                    <div class="addon-options">
                        <label class="addon-item">
                            <input type="checkbox" name="addon" value="rain-repellent" data-price="15.00">
                            <div class="addon-content">
                                <div class="addon-name">Rain Repellent Treatment</div>
                                <div class="addon-price">+£15.00</div>
                                <div class="addon-description">Hydrophobic coating for improved visibility</div>
                            </div>
                        </label>

                        <label class="addon-item">
                            <input type="checkbox" name="addon" value="windshield-protection" data-price="25.00">
                            <div class="addon-content">
                                <div class="addon-name">Chip Protection Film</div>
                                <div class="addon-price">+£25.00</div>
                                <div class="addon-description">Protective film against stone chips</div>
                            </div>
                        </label>

                        <label class="addon-item">
                            <input type="checkbox" name="addon" value="uv-protection" data-price="20.00">
                            <div class="addon-content">
                                <div class="addon-name">UV Protection</div>
                                <div class="addon-price">+£20.00</div>
                                <div class="addon-description">Advanced UV-blocking treatment</div>
                            </div>
                        </label>

                        <label class="addon-item">
                            <input type="checkbox" name="addon" value="premium-cleaning" data-price="10.00">
                            <div class="addon-content">
                                <div class="addon-name">Complete Vehicle Cleaning</div>
                                <div class="addon-price">+£10.00</div>
                                <div class="addon-description">Interior and exterior cleaning service</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Additional Notes -->
                <div class="form-section">
                    <h2 class="section-title">Additional Information</h2>

                    <div class="form-group">
                        <label for="notes">Notes (Optional)</label>
                        <textarea id="notes" rows="4" placeholder="Include any specific requirements or damage details"></textarea>
                    </div>
                </div>

                <button type="submit" class="submit-btn">CONFIRM BOOKING</button>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="success-modal" id="success-modal">
        <div class="success-content">
            <div class="success-icon">✓</div>
            <h2 class="success-title">Booking Confirmed</h2>
            <p class="success-message">Your appointment has been registered. You will receive a confirmation email with booking details and service information.</p>

            <div class="booking-details" id="booking-summary"></div>

            <button class="close-modal-btn" onclick="closeModal()">CLOSE</button>
        </div>
    </div>

    <script>
        // Set minimum date to today
        const dateInput = document.getElementById('appointment-date');
        const today = new Date().toISOString().split('T')[0];
        dateInput.setAttribute('min', today);

        // Form submission handler
        document.getElementById('booking-form').addEventListener('submit', function(e) {
            e.preventDefault();

            // Collect form data
            const formData = {
                registration: document.getElementById('registration').value,
                windowType: document.getElementById('window-type').value,
                customerName: document.getElementById('customer-name').value,
                customerPhone: document.getElementById('customer-phone').value,
                customerEmail: document.getElementById('customer-email').value,
                customerLanguage: document.getElementById('customer-language').value,
                workshop: document.getElementById('workshop').value,
                appointmentDate: document.getElementById('appointment-date').value,
                appointmentTime: document.getElementById('appointment-time').value,
                notes: document.getElementById('notes').value,
                addons: []
            };

            // Collect selected add-ons
            const addonCheckboxes = document.querySelectorAll('input[name="addon"]:checked');
            addonCheckboxes.forEach(checkbox => {
                formData.addons.push({
                    name: checkbox.value,
                    price: checkbox.dataset.price
                });
            });

            // OneSignal SDK Integration
            if (window.OneSignal) {
                try {
                    // 1. Set Language
                    const languageMap = {
                        'english': 'en',
                        'danish': 'da',
                        'swedish': 'sv',
                        'norwegian': 'nb',  // Norwegian Bokmål (ISO 639-1)
                        'german': 'de',
                        'french': 'fr',
                        'spanish': 'es'
                    };
                    const languageCode = languageMap[formData.customerLanguage] || 'en';
                    window.OneSignal.User.setLanguage(languageCode);
                    console.log('OneSignal: Language set to', languageCode);

                    // 2. Add Tags
                    // Add customer name tag
                    window.OneSignal.User.addTag('customer_name', formData.customerName);
                    console.log('OneSignal: Tag added - customer_name:', formData.customerName);

                    // Add appointment time tag with UNIX timestamp
                    // Combine date and time to create UNIX timestamp
                    const appointmentDateTime = new Date(formData.appointmentDate + 'T' + formData.appointmentTime + ':00');
                    const unixTimestamp = Math.floor(appointmentDateTime.getTime() / 1000);
                    window.OneSignal.User.addTag('appointment_time', unixTimestamp.toString());
                    console.log('OneSignal: Tag added - appointment_time:', unixTimestamp);

                    // 3. Track Event with all booking information
                    const workshopText = document.getElementById('workshop').selectedOptions[0].text;
                    const workshopName = workshopText.split(' - ')[0];

                    // Build event properties
                    const eventProperties = {
                        // Vehicle Information
                        vehicle_registration: formData.registration,
                        glass_type: formData.windowType,

                        // Service Location
                        workshop_id: formData.workshop,
                        workshop_name: workshopName,

                        // Appointment Details
                        appointment_date: formData.appointmentDate,
                        appointment_time: formData.appointmentTime,

                        // Additional Services (individual boolean flags)
                        addon_rain_repellent: formData.addons.some(a => a.name === 'rain-repellent'),
                        addon_chip_protection: formData.addons.some(a => a.name === 'windshield-protection'),
                        addon_uv_protection: formData.addons.some(a => a.name === 'uv-protection'),
                        addon_premium_cleaning: formData.addons.some(a => a.name === 'premium-cleaning')
                    };

                    // Add notes only if not empty
                    if (formData.notes && formData.notes.trim() !== '') {
                        eventProperties.notes = formData.notes.trim();
                    }

                    window.OneSignal.User.trackEvent('appointment_booked', eventProperties);
                    console.log('OneSignal: Event tracked - appointment_booked', eventProperties);

                } catch (error) {
                    console.error('OneSignal SDK Error:', error);
                }
            }

            // Display success modal with booking details
            showSuccessModal(formData);

            // Log to console (for demo purposes)
            console.log('Booking submitted:', formData);
        });

        function showSuccessModal(data) {
            const modal = document.getElementById('success-modal');
            const summary = document.getElementById('booking-summary');

            // Format window type
            const windowTypeText = document.getElementById('window-type').selectedOptions[0].text;
            const workshopText = document.getElementById('workshop').selectedOptions[0].text;

            // Format date
            const dateObj = new Date(data.appointmentDate);
            const formattedDate = dateObj.toLocaleDateString('en-GB', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Format language
            const languageText = document.getElementById('customer-language').selectedOptions[0].text;

            // Build summary HTML
            let summaryHTML = `
                <div class="booking-detail-item">
                    <span class="detail-label">Name:</span>
                    <span class="detail-value">${data.customerName}</span>
                </div>
                <div class="booking-detail-item">
                    <span class="detail-label">Phone:</span>
                    <span class="detail-value">${data.customerPhone}</span>
                </div>
                <div class="booking-detail-item">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">${data.customerEmail}</span>
                </div>
                <div class="booking-detail-item">
                    <span class="detail-label">Language:</span>
                    <span class="detail-value">${languageText}</span>
                </div>
                <div class="booking-detail-item">
                    <span class="detail-label">Registration:</span>
                    <span class="detail-value">${data.registration}</span>
                </div>
                <div class="booking-detail-item">
                    <span class="detail-label">Glass Type:</span>
                    <span class="detail-value">${windowTypeText}</span>
                </div>
                <div class="booking-detail-item">
                    <span class="detail-label">Workshop:</span>
                    <span class="detail-value">${workshopText.split(' - ')[0]}</span>
                </div>
                <div class="booking-detail-item">
                    <span class="detail-label">Date:</span>
                    <span class="detail-value">${formattedDate}</span>
                </div>
                <div class="booking-detail-item">
                    <span class="detail-label">Time:</span>
                    <span class="detail-value">${data.appointmentTime}</span>
                </div>
            `;

            if (data.addons.length > 0) {
                const addonNames = data.addons.map(a => a.name.replace(/-/g, ' ')).join(', ');
                summaryHTML += `
                    <div class="booking-detail-item">
                        <span class="detail-label">Additional Services:</span>
                        <span class="detail-value">${addonNames}</span>
                    </div>
                `;
            }

            summary.innerHTML = summaryHTML;
            modal.style.display = 'flex';
        }

        function closeModal() {
            const modal = document.getElementById('success-modal');
            modal.style.display = 'none';

            // Reset form
            document.getElementById('booking-form').reset();
        }

        // Close modal when clicking outside
        document.getElementById('success-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
